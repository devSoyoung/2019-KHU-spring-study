# 2. 고립된 단위 테스트
단위테스트는 쉽고, 빠르고 명확한 작은 단위어야 한다.
* 테스트 실패 시 원인을 찾기 쉽기 때문
* **불가능한 경우** : 다른 오브젝트와 환경에 의존하고 있을 때, 테스트 중인 대상에서 생긴 오류인지 다른 오브젝트나 환경의 오류인지 원인을 찾기 쉽지 않음

## 2-1. 복잡한 의존관계 속의 테스트

![image](https://dhsim86.github.io/static/assets/img/blog/web/2017-09-07-toby_spring_06_aop/02.png)

### UserService
UserService는 매우 간단한 기능만을 가지고 있지만, 세 가지 타입의 의존 오브젝트가 필요하다.
* `UserDaoJdbc`: DB, 데이터를 주고받기 위한 클래스
* `TransactionManager`: 트랜잭션 처리
* `MailSender`: 메일 전송

### UserServiceTest
본래의 목적인 UserService에 대한 테스트임
* 세 가지 의존관계를 갖고 있기 때문에, 테스트 진행 동안 세 오브젝트가 모두 정상이어야 함
* 실제로는 해당 오브젝트 뒤에 존재하는 더 많은 오브젝트, 환경, 서비스, 서버 등을 함께 테스트하는 것

## 2-2. 테스트 대상 오브젝트 고립시키기
테스트 대상에 외부 환경에 영향받지 않으려면 테스트를 고립시키고, 대역을 사용해야 한다.

### 테스트를 위한 UserServiceImpl 고립


### 단위테스트 vs 통합테스트
* 둘 중 항상 단위테스트를 먼저 고려할 것
* 외부 리소스를 사용하는 경우에는 통합테스트를 함
    * 외부와의 의존관계는 모두 차단하고, 필요에 따라 목 오브젝트 등의 테스트 대역을 사용
    
스프링이 권장하는 유연한 테스트코드를 만들다보면 테스트도 쉬워지고, 리팩토링도 쉽게 접근할 수 있음

## 2-3. 목 프레임워크
### Mockito 프레임워크
목 클래스를 일일이 준비해둘 필요가 없도록 도와주는 프레임워크

1. 인터페이스를 이용해 목오브젝트 생성
2. 목 오브젝트가 리턴할 값이 있으면 이를 지정해 준다.
3. 테스트 대상 오브젝트에 DI해서 목 오브젝트가 테스트 중에 사용되도록 만든다.
4. 진짜 테스트

***
## 참고링크
* [토비의 스프링 6장(2) - 고립된 단위 테스트](https://happyer16.tistory.com/entry/토비의-스프링-6장2-고립된-단위-테스트?category=692836)
